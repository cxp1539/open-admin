(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1f32ea80"],{8491:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-card",{style:{minHeight:"592px"},attrs:{bordered:!1}},[n("a-row",{attrs:{gutter:24}},[n("a-col",{attrs:{md:4}},[n("a-list",{ref:"roleList",attrs:{itemLayout:"vertical",dataSource:e.roles},scopedSlots:e._u([{key:"renderItem",fn:function(t,r){return n("a-list-item",{key:r},[n("a-list-item-meta",{style:{marginBottom:"0"}},[n("span",{staticStyle:{"text-align":"center",display:"block"},attrs:{slot:"description"},slot:"description"},[e._v(e._s(t.describe))]),n("a",{staticStyle:{"text-align":"center",display:"block"},style:{color:e.lindex==r?e.theme.color:""},attrs:{slot:"title"},on:{click:function(n){return e.edit(t,r)}},slot:"title"},[e._v(e._s(t.name))])])],1)}}])})],1),n("a-col",{attrs:{md:20}},[n("div",{staticStyle:{"max-width":"800px"}},[e.isMobile?n("a-divider"):e._e(),e.mdl.id?n("div",[n("h3",[e._v("角色："+e._s(e.mdl.name))])]):e._e(),n("a-form",{attrs:{form:e.form,layout:e.isMobile?"vertical":"horizontal"}},[n("a-form-item",{attrs:{label:"唯一键"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["id",{rules:[{required:!0,message:"Please input unique key!"}]}],expression:"[ 'id', {rules: [{ required: true, message: 'Please input unique key!' }]} ]"}],attrs:{disabled:-1!=e.mdl.id,placeholder:"请填写唯一键"}})],1),n("a-form-item",{attrs:{label:"角色名称"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"Please input role name!"}]}],expression:"[ 'name', {rules: [{ required: true, message: 'Please input role name!' }]} ]"}],attrs:{placeholder:"请填写角色名称"}})],1),n("a-form-item",{attrs:{label:"备注说明"}},[n("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["describe",{rules:[{required:!0,message:"Please input role name!"}]}],expression:"[ 'describe', {rules: [{ required: true, message: 'Please input role name!' }]} ]"}],attrs:{row:3,placeholder:"请填写角色名称"}})],1),n("a-form-item",{attrs:{label:"拥有权限"}},e._l(e.permissions,(function(t,r){return n("a-row",{key:r,attrs:{gutter:16}},[n("a-col",{attrs:{xl:4,lg:24}},[e._v(" "+e._s(t.name)+"： ")]),n("a-col",{attrs:{xl:20,lg:24}},[t.actionsOptions.length>0?n("a-checkbox",{attrs:{indeterminate:t.indeterminate,checked:t.checkedAll},on:{change:function(n){return e.onChangeCheckAll(n,t)}}},[e._v(" 全选 ")]):e._e(),n("a-checkbox-group",{attrs:{options:t.actionsOptions},on:{change:function(n){return e.onChangeCheck(t)}},model:{value:t.selected,callback:function(n){e.$set(t,"selected",n)},expression:"permission.selected"}})],1)],1)})),1),n("a-form-item",[n("a-button",{attrs:{type:"danger"},on:{click:e.deleteRole}},[e._v("删除角色")]),n("a-button",{staticStyle:{"margin-left":"16px"},attrs:{type:"primary"},on:{click:e.editRole}},[e._v("提交角色")])],1)],1)],1)])],1)],1)},i=[],a=n("5530"),o=(n("3bae"),n("3337"),n("1d43"),n("1d40")),s=n("ca00"),l=n("85ee"),c=n.n(l),u=n("5880"),d={name:"RoleList",components:{},data:function(){return{lindex:0,description:"后台管理中的权限管理以及角色管理，可用于基于 RBAC 设计的角色权限控制，颗粒度细到每一个操作类型。",form:this.$form.createForm(this),mdl:{},roles:[],permissions:[]}},computed:Object(a["a"])({},Object(u["mapState"])("setting",["isMobile","theme"])),created:function(){this.queryParam=this.$route.query,this.initData()},methods:{initData:function(){var e=this;Object(o["h"])().then((function(t){e.roles=t.data,e.roles.push({id:"-1",name:"新增角色",describe:"新增一个角色"}),setTimeout((function(){e.edit(e.roles[e.lindex],e.lindex)}),16)})),this.loadPermissions()},edit:function(e,t){var n=this;if(this.lindex=t,this.mdl=Object.assign({},e),"-1"==e.id&&(this.mdl.permissions=[]),this.mdl.permissions&&this.permissions){var r={};this.mdl.permissions.forEach((function(e){r[e.id]=e.operation.map((function(e){return e.action}))})),this.permissions.forEach((function(e){var t=r[e.id];e.selected=t||[],n.onChangeCheck(e)}))}this.$nextTick((function(){n.form.setFieldsValue(c()(n.mdl,"id","name","describe"))}))},onChangeCheck:function(e){e.indeterminate=!!e.selected.length&&e.selected.length<e.actionsOptions.length,e.checkedAll=e.selected.length===e.actionsOptions.length},onChangeCheckAll:function(e,t){Object.assign(t,{selected:e.target.checked?t.actionsOptions.map((function(e){return e.value})):[],indeterminate:!1,checkedAll:e.target.checked})},deleteRole:function(){var e=this,t=this.$confirm({title:"提示",content:"确定要删除该角色信息吗 ?",onOk:function(){return Object(o["c"])({roleId:e.mdl.id}).then((function(n){e.$message.success("删除角色信息成功"),t.destroy(),e.initData()}))},onCancel:function(){}})},editRole:function(){var e=this;this.form.validateFields((function(t,n){if(!t){var r={id:n.id,name:n.name,remark:n.describe};r.permissions=e.permissions.map((function(e){for(var t=JSON.parse(e.operation),r=[],i=0;i<t.length;i++)for(var a=0;a<e.selected.length;a++)if(e.selected[a]==t[i].action){r.push(t[i]);break}return{roleId:n.id,permissionId:e.id,operation:JSON.stringify(r)}})),Object(o["e"])(r).then((function(t){e.$message.success("提交用户角色信息成功"),e.initData()}))}}))},loadPermissions:function(){var e=this;Object(o["g"])().then((function(t){var n=t.data;e.permissions=n.map((function(e){var t=Object(s["a"])(e.operation);return e.checkedAll=!1,e.selected=[],e.indeterminate=!1,e.actionsOptions=t.map((function(e){return{label:e.describe,value:e.action}})),e}))}))}}},m=d,f=n("2877"),h=Object(f["a"])(m,r,i,!1,null,null,null);t["default"]=h.exports},"85ee":function(e,t,n){(function(t){var n=1/0,r=9007199254740991,i="[object Arguments]",a="[object Function]",o="[object GeneratorFunction]",s="[object Symbol]",l="object"==typeof t&&t&&t.Object===Object&&t,c="object"==typeof self&&self&&self.Object===Object&&self,u=l||c||Function("return this")();function d(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function m(e,t){var n=-1,r=e?e.length:0,i=Array(r);while(++n<r)i[n]=t(e[n],n,e);return i}function f(e,t){var n=-1,r=t.length,i=e.length;while(++n<r)e[i+n]=t[n];return e}var h=Object.prototype,p=h.hasOwnProperty,b=h.toString,v=u.Symbol,g=h.propertyIsEnumerable,y=v?v.isConcatSpreadable:void 0,k=Math.max;function O(e,t,n,r,i){var a=-1,o=e.length;n||(n=_),i||(i=[]);while(++a<o){var s=e[a];t>0&&n(s)?t>1?O(s,t-1,n,r,i):f(i,s):r||(i[i.length]=s)}return i}function j(e,t){return e=Object(e),x(e,t,(function(t,n){return n in e}))}function x(e,t,n){var r=-1,i=t.length,a={};while(++r<i){var o=t[r],s=e[o];n(s,o)&&(a[o]=s)}return a}function w(e,t){return t=k(void 0===t?e.length-1:t,0),function(){var n=arguments,r=-1,i=k(n.length-t,0),a=Array(i);while(++r<i)a[r]=n[t+r];r=-1;var o=Array(t+1);while(++r<t)o[r]=n[r];return o[t]=a,d(e,this,o)}}function _(e){return S(e)||C(e)||!!(y&&e&&e[y])}function A(e){if("string"==typeof e||N(e))return e;var t=e+"";return"0"==t&&1/e==-n?"-0":t}function C(e){return P(e)&&p.call(e,"callee")&&(!g.call(e,"callee")||b.call(e)==i)}var S=Array.isArray;function q(e){return null!=e&&F(e.length)&&!$(e)}function P(e){return I(e)&&q(e)}function $(e){var t=R(e)?b.call(e):"";return t==a||t==o}function F(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}function R(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function I(e){return!!e&&"object"==typeof e}function N(e){return"symbol"==typeof e||I(e)&&b.call(e)==s}var D=w((function(e,t){return null==e?{}:j(e,m(O(t,1),A))}));e.exports=D}).call(this,n("c8ba"))}}]);